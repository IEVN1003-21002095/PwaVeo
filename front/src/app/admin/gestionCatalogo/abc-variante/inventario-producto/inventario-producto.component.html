<div class="modal-overlay font-sans" *ngIf="visible">
  <style>
    .modal-overlay { 
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background-color: rgba(0,0,0,0.6); z-index: 2000; display: flex; 
        align-items: center; justify-content: center; backdrop-filter: blur(3px); 
        padding: 1rem; 
        opacity: 1; transition: opacity 0.2s ease-out;
    }
    .modal-card { 
        background-color: #ffffff; width: 100%; max-width: 900px; 
        border-radius: 12px; box-shadow: 0 20px 40px rgba(0,0,0,0.25); 
        display: flex; flex-direction: column; max-height: 90vh; 
        transform: scale(1); transition: transform 0.2s ease-out;
    }
    .modal-card.show { transform: scale(1); }
    .modal-header { 
        padding: 1.25rem 2rem; border-bottom: 1px solid #f0f0f0; 
        display: flex; justify-content: space-between; align-items: center; 
    }
    .modal-title { font-weight: 700; color: #111; font-size: 1.2rem; }
    .btn-close { background: none; border: none; font-size: 1.5rem; color: #999; cursor: pointer; }
    .btn-close:hover { color: #333; }
    .modal-body { padding: 2rem; overflow-y: auto; }

    .btn-action-primary { 
        background-color: #00325E; color: white; border: none; border-radius: 6px; 
        padding: 10px 24px; font-size: 0.85rem; font-weight: 800; text-transform: uppercase; 
        letter-spacing: 0.5px; display: inline-flex; align-items: center; gap: 8px; 
        transition: all 0.2s ease-in-out; text-decoration: none; 
    }
    .btn-action-primary:hover { background-color: #002244; transform: translateY(-1px); }

    .table-clean { width: 100%; border-collapse: separate; border-spacing: 0; }
    .table-clean thead th { background-color: #f8f9fc; color: #4a5568; font-weight: 600; 
        font-size: 0.85rem; padding: 12px 16px; border-bottom: 1px solid #edf2f7; white-space: nowrap; }
    .table-clean tbody td { background-color: white; border-bottom: 1px solid #f0f0f0; 
        padding: 16px; vertical-align: middle; font-size: 0.9rem; color: #2d3748; }
    .table-clean tbody tr:hover td { background-color: #fafbfc; }

    .btn-action-subtle { color: #a0aec0; transition: 0.2s; font-size: 1.1rem; border: none; 
        background: transparent; padding: 4px; }
    .btn-action-subtle:hover { color: #00325E; transform: scale(1.1); }
    .btn-action-subtle.danger:hover { color: #dc3545; }

    .btn-clear-icon {
        font-size: 1rem; color: #adb5bd; background: transparent; border: none; cursor: pointer;
        transition: color 0.2s ease, transform 0.2s ease;
    }
    .btn-clear-icon:hover { color: #00325E; transform: scale(1.2); }

    .status-pill { display: inline-flex; align-items: center; padding: 4px 10px; 
        border-radius: 6px; font-size: 0.75rem; font-weight: 600; border: 1px solid; background: white; }
    .status-pill.ok { border-color: #c3e6cb; color: #155724; } 
    .status-pill.ok::before { content: ''; display: inline-block; width: 6px; height: 6px; 
        border-radius: 50%; margin-right: 6px; background-color: #28a745; }
    .status-pill.bajo { border-color: #f5c6cb; color: #721c24; } 
    .status-pill.bajo::before { content: ''; display: inline-block; width: 6px; height: 6px; 
        border-radius: 50%; margin-right: 6px; background-color: #dc3545; }

    .filter-group { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; align-items: center; }
    .filter-group select { border-radius: 6px; padding: 6px 12px; border: 1px solid #d1d5db; }

    .segment-group { display: inline-flex; background-color: #f1f3f5; padding: 4px; 
        border-radius: 8px; border: 1px solid #e9ecef; }
    .segment-btn { border: none; background: transparent; color: #6c757d; 
        font-size: 0.85rem; font-weight: 500; padding: 6px 16px; border-radius: 6px; 
        transition: all 0.2s ease; cursor: pointer; }
    .segment-btn:hover { color: #00325E; }
    .segment-btn.active { background-color: white; color: #00325E; font-weight: 700; 
        box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
  </style>

  <div class="modal-card show">

    <div class="modal-header">
<h3 class="modal-title">ID: {{ productId }}</h3>
      <a [routerLink]="['/gestionCatalogo']" class="btn-close">&times;</a>
    </div>

    <div class="modal-body">
      <a class="btn-action-primary mb-4" [routerLink]="['agregar']">
        <i class="bi bi-plus-lg"></i> AGREGAR VARIANTE
      </a>

      <div class="filter-group">
        <select [(ngModel)]="filtros.color" (ngModelChange)="aplicarFiltros()">
          <option value="">Todos los colores</option>
          <option *ngFor="let c of colores" [value]="c.nombre">{{ c.nombre }}</option>
        </select>
        <select [(ngModel)]="filtros.talla" (ngModelChange)="aplicarFiltros()">
          <option value="">Todas las tallas</option>
          <option *ngFor="let t of tallas" [value]="t.nombre">{{ t.nombre }}</option>
        </select>

        <div class="segment-group">
          <button class="segment-btn" [class.active]="filtros.stock === ''" (click)="filtros.stock=''; aplicarFiltros()">Todos</button>
          <button class="segment-btn" [class.active]="filtros.stock === 'con'" (click)="filtros.stock='con'; aplicarFiltros()">OK</button>
          <button class="segment-btn" [class.active]="filtros.stock === 'sin'" (click)="filtros.stock='sin'; aplicarFiltros()">Bajo</button>
        </div>

        <button class="btn-clear-icon" title="Limpiar filtros" (click)="limpiarFiltros()">
          <i class="bi bi-x-circle"></i>
        </button>
      </div>

      <div class="table-responsive" *ngIf="!cargando && variantesFiltradas.length">
<table class="table table-clean mb-0">
  <thead>
    <tr>
      <th class="ps-3">ID</th>
      <th>Color</th>
      <th>Talla</th>
      <th>Ubicaci√≥n</th> 
      <th class="text-end">Cantidad</th>
      <th>Stock</th>
      <th class="text-end pe-3">Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let v of variantesFiltradas">
      <td class="ps-3 text-muted small">{{ v.id }}</td>
      <td class="fw-bold text-dark">{{ v.color }}</td>
      <td><span class="badge bg-light text-dark border fw-normal">{{ v.talla }}</span></td>
      <td>{{ v.ubicacion }}</td> 
      <td class="text-end fw-bold text-dark">{{ v.cantidad }}</td>
      <td class="text-center">
        <span class="status-pill" [ngClass]="v.cantidad < 5 ? 'bajo' : 'ok'">
          {{ v.cantidad < 5 ? 'Bajo' : 'OK' }}
        </span>
      </td>
      <td class="pe-3 text-end">
        <div class="d-flex justify-content-end gap-2">
          <a class="btn-action-subtle" [routerLink]="['./editar', v.id]" title="Editar">
            <i class="bi bi-pencil-square"></i>
          </a>
          <a class="btn-action-subtle danger" [routerLink]="['./eliminar', v.id]" title="Eliminar">
            <i class="bi bi-trash"></i>
          </a>
        </div>
      </td>
    </tr>
  </tbody>
</table>
      </div>

      <div *ngIf="!cargando && !variantesFiltradas.length" class="text-center py-5 mt-2 border rounded bg-light">
        <h5 class="text-muted fw-normal">No hay variantes de inventario para este producto.</h5>
      </div>

      <div *ngIf="cargando" class="text-center py-5 mt-2">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="small text-muted mt-2">Cargando variantes...</p>
      </div>
    </div>

    <router-outlet></router-outlet>
  </div>
</div>