<div class="admin-page">
  <div class="page-container">

    <!-- Loading -->
    <div *ngIf="isLoading" class="alert alert-info">
      <i class="bi bi-hourglass-split"></i> Cargando detalles de la venta...
    </div>

    <!-- Error -->
    <div *ngIf="error && !isLoading" class="alert alert-danger">
      <i class="bi bi-exclamation-circle"></i> {{ error }}
    </div>

    <!-- Content -->
    <div *ngIf="!isLoading && venta">
      
      <!-- Header -->
      <div class="page-header">
        <div>
          <h2 class="page-title">
            <i class="bi bi-receipt me-2"></i>Detalles Venta #{{ venta.venta_id || venta.id }}
          </h2>
          <p class="page-subtitle">Información completa del pedido</p>
        </div>
        <button [routerLink]="['/admin/ventas']" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left me-1"></i> Volver
        </button>
      </div>

      <!-- Info Cards Row -->
      <div class="row g-3 mb-4">
        <div class="col-md-6">
          <div class="content-card">
            <div class="card-header-custom">
              <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i>Información General</h5>
            </div>
            <div class="card-body">
              <div class="info-row">
                <span class="info-label"><i class="bi bi-person me-2"></i>Cliente ID:</span>
                <span class="info-value">{{ venta.cliente_id || venta.clienteId }}</span>
              </div>
              <div class="info-row">
                <span class="info-label"><i class="bi bi-calendar3 me-2"></i>Fecha:</span>
                <span class="info-value">{{ venta.fecha | date:'dd/MM/yyyy, h:mm a' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label"><i class="bi bi-tag me-2"></i>Estado:</span>
                <div class="d-flex align-items-center gap-2">
                  <span class="badge status-badge"
                        [class.bg-success]="venta.estado === 'completada'"
                        [class.bg-warning]="venta.estado === 'pendiente'"
                        [class.bg-danger]="venta.estado === 'cancelada'">
                    {{ venta.estado | uppercase }}
                  </span>
                  <div class="btn-group" role="group">
                    <button *ngFor="let estado of estadosDisponibles"
                            type="button"
                            class="btn btn-sm"
                            [class.btn-outline-secondary]="venta.estado !== estado.value"
                            [ngClass]="estado.class"
                            [class.text-white]="venta.estado === estado.value"
                            [disabled]="isUpdatingStatus || venta.estado === estado.value"
                            (click)="cambiarEstado(estado.value)"
                            [title]="'Cambiar a ' + estado.label">
                      {{ estado.label }}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="content-card">
            <div class="card-header-custom">
              <h5 class="mb-0"><i class="bi bi-cash-stack me-2"></i>Resumen Financiero</h5>
            </div>
            <div class="card-body">
              <div class="info-row">
                <span class="info-label">Subtotal:</span>
                <span class="info-value">MX${{ venta['subtotal'] | number:'1.2-2' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Descuento:</span>
                <span class="info-value text-danger">-MX${{ venta['descuento'] | number:'1.2-2' }}</span>
              </div>
              <div class="info-row border-top pt-2 mt-2">
                <span class="info-label fw-bold">Total:</span>
                <span class="info-value fw-bold text-success fs-5">MX${{ venta.total | number:'1.2-2' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Products Table -->
      <div class="content-card">
        <div class="card-header-custom">
          <h5 class="mb-0"><i class="bi bi-box-seam me-2"></i>Productos Comprados</h5>
          <span class="badge bg-primary">{{ detalles.length || 0 }} Productos</span>
        </div>

        <div *ngIf="!detalles || detalles.length === 0" class="card-body text-center text-muted py-5">
          <i class="bi bi-inbox fs-1 d-block mb-2"></i>
          <p class="mb-0">No hay detalles disponibles</p>
        </div>

        <div *ngIf="detalles && detalles.length > 0" class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-header">
              <tr>
                <th>Producto</th>
                <th class="text-center">Cantidad</th>
                <th>Precio Unitario</th>
                <th>Precio Venta</th>
                <th>Descuento</th>
                <th class="text-end">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let det of detalles">
                <td class="fw-semibold">{{ det.nombre_producto_venta }}</td>
                <td class="text-center">
                  <span class="badge bg-secondary">{{ det.cantidad }}</span>
                </td>
                <td>MX${{ det.precio_unitario | number:'1.2-2' }}</td>
                <td>MX${{ det.precio_unitario_venta | number:'1.2-2' }}</td>
                <td class="text-danger">-MX${{ det.descuento_unitario | number:'1.2-2' }}</td>
                <td class="text-end fw-bold text-success">MX${{ (det.cantidad * det.precio_unitario_venta) | number:'1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
</div>
