<div style="font-family: Arial, sans-serif; background-color: #f8f9fa; min-height: 100vh; padding: 20px;">
  <div style="max-width: 900px; margin: 0 auto;">
    <h1 style="color: #343a40; text-align: center; margin-bottom: 30px;">Mis pedidos</h1>

    <div *ngIf="isLoading" style="text-align: center; padding: 50px;">
      <div style="border: 4px solid rgba(0,0,0,.1); border-left-color: #083b66; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; display: inline-block;"></div>
      <p style="margin-top: 15px; color: #6c757d;">Cargando historial de pedidos...</p>
    </div>

    <div *ngIf="error" style="background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
      <strong>Error:</strong> {{ error }}
    </div>

    <div *ngIf="!isLoading && !error && orders.length === 0" style="text-align: center; padding: 50px; background-color: #ffffff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
      <p style="color: #6c757d; font-size: 1.1em;">No tienes pedidos registrados. ¡Es un buen momento para tu primera compra!</p>
    </div>

    <div *ngIf="!isLoading && !error && orders.length > 0">
      <div *ngFor="let order of orders" style="background-color: #ffffff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; overflow: hidden;">
        
        <div (click)="toggleOrderDetails(order)" style="padding: 15px 20px; border-bottom: 1px solid #e9ecef; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background-color: #fdfdfd;">
          <div>
            <span style="font-weight: bold; color: #343a40;">PEDIDO #{{ order.pedido_id }}</span>
            <span style="color: #6c757d; margin-left: 10px;">Estado: 
                <span [style.color]="order.estado_display === 'entregado' ? '#28a745' : order.estado_display === 'cancelada' ? '#dc3545' : '#ffc107'">
                    {{ order.estado_display | uppercase }}
                </span>
            </span>
            <div style="font-size: 0.9em; color: #888;">Fecha: {{ order.fecha_pedido | date:'dd/MM/yyyy HH:mm' }}</div>
          </div>
          <div style="font-weight: bold; color: #083b66;">
            MXN {{ order.total | number:'1.2-2' }}
            <span style="margin-left: 15px; font-size: 1.2em; transform: rotate(0deg); transition: transform 0.3s ease; display: inline-block;" 
                  [style.transform]="order.isExpanded ? 'rotate(180deg)' : 'rotate(0deg)'">
              &#9660; 
            </span>
          </div>
        </div>

        <div *ngIf="order.isExpanded" style="padding: 20px; border-top: 1px solid #eee; background-color: #fbfbfb;">
          
          <div *ngIf="order.isLoadingDetails" style="text-align: center; padding: 30px;">
            <div style="border: 4px solid rgba(0,0,0,.1); border-left-color: #083b66; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; display: inline-block;"></div>
            <p style="margin-top: 10px; color: #6c757d;">Cargando detalles...</p>
          </div>

          <div *ngIf="order.errorDetails" style="background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
            <strong>Error:</strong> {{ order.errorDetails }}
          </div>

          <div *ngIf="order.details && !order.isLoadingDetails && !order.errorDetails" style="display: flex; flex-wrap: wrap; gap: 20px;">
            
            <div style="flex: 1 1 45%; min-width: 280px; background-color: #fff; padding: 15px; border-radius: 5px; box-shadow: 0 1px 5px rgba(0,0,0,0.03);">
              <h4 style="color: #343a40; margin-top: 0; margin-bottom: 15px; font-size: 1.1em;">Productos</h4>
              <div *ngFor="let item of order.details.items" style="display: flex; align-items: center; margin-bottom: 10px; border-bottom: 1px dashed #eee; padding-bottom: 8px;">
                <div style="width: 50px; height: 50px; background-color: #e9ecef; border-radius: 5px; margin-right: 10px; display: flex; align-items: center; justify-content: center; color: #6c757d; font-size: 0.8em;">IMG</div>
                <div>
                  <div style="font-weight: bold; color: #555;">{{ item.nombre_producto_venta }}</div>
                  <div style="font-size: 0.9em; color: #777;">x{{ item.cantidad }}</div>
                </div>
                <div style="margin-left: auto; font-weight: bold; color: #083b66;">
                  MXN {{ item.precio_unitario_venta | number:'1.2-2' }}
                </div>
              </div>
            </div>

            <div style="flex: 1 1 45%; min-width: 280px; background-color: #fff; padding: 15px; border-radius: 5px; box-shadow: 0 1px 5px rgba(0,0,0,0.03);">
              <h4 style="color: #343a40; margin-top: 0; margin-bottom: 15px; font-size: 1.1em;">Envío y Dirección</h4>
              
              <div *ngIf="order.details.pedido.numero_guia !== 'N/A'" style="margin-bottom: 10px; padding: 8px; background-color: #e9f7ef; border-radius: 5px; border-left: 3px solid #28a745;">
                <div style="font-weight: bold; color: #555;">No. de Seguimiento:</div>
                <div style="color: #083b66; font-weight: bold;">{{ order.details.pedido.numero_guia }}</div>
              </div>
              
              <div style="margin-bottom: 10px;">
                <div style="font-weight: bold; color: #555;">Fecha de Envío:</div>
                <div style="color: #777;">{{ order.details.pedido.fecha_envio ? (order.details.pedido.fecha_envio | date:'dd/MM/yyyy') : 'Pendiente' }}</div>
              </div>

              <h5 style="color: #343a40; margin-top: 20px; margin-bottom: 10px; font-size: 1em;">Dirección de entrega:</h5>
              <div *ngIf="order.details.direccion_entrega" style="color: #777;">
                {{ order.details.direccion_entrega.nombre_destinatario }}<br>
                {{ order.details.direccion_entrega.calle }}, CP {{ order.details.direccion_entrega.codigo_postal }}<br>
                {{ order.details.direccion_entrega.ciudad }}, {{ order.details.direccion_entrega.estado }}
              </div>
            </div>
            
            <div style="flex: 1 1 100%; min-width: 280px; background-color: #fff; padding: 15px; border-radius: 5px; box-shadow: 0 1px 5px rgba(0,0,0,0.03);">
              <h4 style="color: #343a40; margin-top: 0; margin-bottom: 15px; font-size: 1.1em;">Resumen del Pago</h4>
              <div style="display: flex; justify-content: space-between; margin-bottom: 5px; color: #555;">
                <span>Subtotal (Items):</span>
                <span>MXN {{ order.details.pedido.subtotal | number:'1.2-2' }}</span>
              </div>
              
              <div style="display: flex; justify-content: space-between; font-weight: bold; color: #083b66; font-size: 1.2em; border-top: 1px solid #eee; padding-top: 10px;">
                <span>Total pagado:</span>
                <span>MXN {{ order.details.pedido.total | number:'1.2-2' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Animación para el spinner de carga */
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Media query básico para mejor visualización en móviles */
  @media (max-width: 768px) {
    .order-details-content > div {
      flex: 1 1 100% !important;
    }
  }
</style>