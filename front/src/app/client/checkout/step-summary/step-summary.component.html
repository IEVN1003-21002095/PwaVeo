<div class="container py-4">
  <h3>Paso 3: Resumen del Pedido</h3>

  <div *ngIf="purchaseComplete" class="alert alert-success">
    <h4>¡Compra Exitosa!</h4>
    <p>Tu pedido ha sido procesado correctamente.</p>
    <button class="btn btn-primary" routerLink="/client/catalogo">Volver al catálogo</button>
  </div>

  <div *ngIf="!purchaseComplete">
    <div class="card mb-3">
      <div class="card-header"><strong>Dirección de Envío</strong></div>
      <div class="card-body" *ngIf="addressData">
        <p class="mb-1"><strong>{{ addressData.nombre_destinatario }}</strong></p>
        <p class="mb-1">{{ addressData.calle }} {{ addressData.numero_ext }}<span *ngIf="addressData.numero_int">, Int. {{ addressData.numero_int }}</span></p>
        <p class="mb-1">{{ addressData.colonia }}, CP {{ addressData.codigo_postal }}</p>
        <p class="mb-1">{{ addressData.ciudad }}, {{ addressData.estado }}</p>
        <p class="mb-1" *ngIf="addressData.telefono"><strong>Tel:</strong> {{ addressData.telefono }}</p>
        <p class="mb-0" *ngIf="addressData.referencia"><strong>Ref:</strong> {{ addressData.referencia }}</p>
      </div>
    </div>

    <div class="card mb-3">
      <div class="card-header"><strong>Método de Pago</strong></div>
      <div class="card-body">
        <p class="mb-0">{{ metodoNombre }}</p>
      </div>
    </div>

    <div class="card mb-3">
      <div class="card-header"><strong>Productos</strong></div>
      <div class="card-body">
        <div *ngFor="let item of cartItems" class="d-flex align-items-center mb-3 pb-3 border-bottom">
          <div style="width: 60px; height: 60px; background: #f0f0f0; border-radius: 8px; overflow: hidden; margin-right: 1rem; flex-shrink: 0;">
            <img [src]="item.imagen || 'https://placehold.co/60x60/f0f0f0/6c757d?text=Prod'" 
                 [alt]="item.nombre"
                 style="width: 100%; height: 100%; object-fit: cover;">
          </div>
          <div class="flex-grow-1">
            <div class="fw-bold">{{ item.nombre }}</div>
            <div class="text-muted small">Talla: {{ item.talla }} · Color: {{ item.color }} · Cantidad: {{ item.cantidad }}</div>
          </div>
          <div class="text-end ms-3">
            <strong>MXN {{ (item.precio * item.cantidad) | number:'1.2-2' }}</strong>
          </div>
        </div>
        <div class="d-flex justify-content-between fw-bold pt-2">
          <span>Subtotal</span>
          <span>MXN {{ subtotal | number:'1.2-2' }}</span>
        </div>
      </div>
    </div>

    <div *ngIf="errorMsg" class="alert alert-danger">{{ errorMsg }}</div>

    <div class="d-flex justify-content-between">
      <button type="button" class="btn btn-secondary" (click)="goBack()">Volver</button>
      <button type="button" class="btn btn-success" (click)="confirmPurchase()" [disabled]="loading">
        {{ loading ? 'Procesando...' : 'Confirmar Compra' }}
      </button>
    </div>
  </div>
</div>